name: repo-sunsetter main action
on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  run-repo-sunsetter:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - name: Run repo-sunsetter
        id: archive
        uses: DSACMS/repo-sunsetter@DSACMS/nat/outputs
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          USE_MATURITY_MODEL_TIERS: "true"
          METADATA_FILE_TYPE: "publiccode.yml"
      - name: Output results
        shell: bash
        run: |
          echo "ğŸŒ… USING OUTPUT VARIABLES ğŸŒ…"
          echo "âœ… Archival checklist issue created: #${{ steps.archive.outputs.archival_checklist_issue_number }} - ${{ steps.archive.outputs.archival_checklist_issue_url }}"
          echo "âœ… README update pull request created: #${{ steps.archive.outputs.readme_pull_request_number }} - ${{ steps.archive.outputs.readme_pull_request_number }}"
          if [ -n "${{ steps.archive.outputs.pr_url }}" ]; then
            echo "âœ… Metadata file update pull request created: ${{ steps.archive.outputs.metadata_update_pull_request_url }}"
          else
            echo "â„¹ï¸ No metadata file update pull request created."
          fi
